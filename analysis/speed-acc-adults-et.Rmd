---
title: "Speed-Acc Adults"
author: "Kyle MacDonald & Aviva Blonder"
date: "August 4, 2016"
output: html_document
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo=T, warning=F, cache=T, message=F, sanitize = T)
```

This script munges and analyzes eye-tracking data for an experiment comparing speed-accuracy tradeoffs when establishing reference in real-time. We vary the information value and saliency of the center fixation and measure the effects on accuracy and RT.

```{r setup 2} 
rm(list = ls())
library(dplyr); library(readr); library(magrittr)
library(ggplot2); library(tidyr); library(knitr)
library(langcog); library(lme4); library(directlabels)
theme_set(theme_bw())
```

Load data and join with trial information (timing, left/right/center images, target info) and with participant info.

```{r load data}
#### read in processed data
d <- read_csv("../data/3_final_merged_data/processed_adult_data.csv")

#### strip .avi and .jpg from stimulus
d$stimulus <- gsub(pattern = ".jpg", "", x = d$stimulus)
d$stimulus <- gsub(pattern = ".avi", "", x = d$stimulus)

### remove validation trial
d %<>% filter(stimulus != "Validation")

#### join trial info
trialinfo_d <- read_csv("../data/demographics/speed-acc-adult-order.csv")
d %<>% left_join(., trialinfo, by = "stimulus")

#### join subject info
subinfo_df <- read_csv("")
d %<>% left_join(subinfo_df, by = "subid")
```


### Filter out unusable participants 

```{r filter out participants with bad data}
##calculate percentage of non-looks - that is, looking away from the screen entirely.
##offscreen == TRUE if x is 0 and y is 1050, so higher bad_looks are worse
d_screentime <- transform(d, offscreen = ((x == 0 & y == 1050) | is.na(x) | is.na(y))) %>%
  select(subid, t, offscreen) %>%
  group_by(subid) %>%
  summarise(bad_looks = sum(offscreen, na.rm = TRUE), total_timeslices = n())

d_screentime <- transform(d_screentime, percent_bad_looks = bad_looks/total_timeslices)

##filter out participants more than 3 standard dev away from mean screentime
sd_ss <- sd(d_screentime$percent_bad_looks)
mean_ss <- mean(d_screentime$percent_bad_looks)

d %<>% left_join(d_screentime)

d$keep <- ifelse(d$percent_bad_looks > (3*sd_ss + mean_ss), 'exclude', 'include')
```

Now we make a table of participant information and trial numbers.

```{r}
d %>% select(subid) %>% 
  unique() %>% 
  summarise(n_subs = n())
```

## Data cleaning/munging

Here we label Areas of Interest to be Left Picture, Right Picture, and the Center Fixation. We also add trial number variable.

Plot the distribution of looking across x-y coordinates. This helps us find the AOIs for data analysis. 

```{r}
ggplot(aes(x = x, y = y), data = d) +
  geom_density2d() +
  xlim(0, 1000) +
  ylim(0, 1250)
```

Get bounding box for AOIs. These numbers are generated by the SMI software and stored as an XML file.

```{r}
rois <- list()
rois[[1]] <- c(0,0,840,550) # left
rois[[2]] <- c(840,0,840,550) # right
rois[[3]] <- c(420,550,840,550) # center
names(rois) <- c("L","R","C")
roi.image(rois) 
```

## Visualize performance (accuracy and rt)

## Standard accuracy and rt analyses

## EWMA filter to remove fast guesses

## Fit Diffusion models

## Stats over DDM parameters
