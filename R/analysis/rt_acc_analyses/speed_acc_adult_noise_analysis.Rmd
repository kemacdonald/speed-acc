---
title: "Speed-Acc Noise Gaze Analysis"
author: "Kyle MacDonald"
output: html_document
---

## Set up 

Here are some helpful links for understanding the workflow for analyzing data in R Markdown (what you're doing in this document!):

 * [Scripts](http://r4ds.had.co.nz/workflow-scripts.html)
 * An R Markdown [guide](https://docs.google.com/document/d/1ajv1VJqEheVws93tnzH-K7145vBKtwD3Az5pg3faRdw/edit?usp=sharing) that I wrote for the lab
 
```{r chunk_options, echo = F}
# code to clear workspace
rm(list=ls()) 

# set some global options
knitr::opts_chunk$set(warning=F, message=F, sanitize = T, 
                      fig.height=5, fig.width=8, echo=T, cache = F)

# read in personal library of helper functions
source("../../helper_functions/libraries_and_functions.R")
```

## Load data

Section 11.2 from [this](http://r4ds.had.co.nz/data-import.html) chapter on data importing is great.


```{r}
table_adult <- read_csv("../../../data/3_final_merged_data/first_shifts/speed_acc_adult_ng_fstshift_tidy.csv")
```

```{r}
table_adult <- table_adult %>% 
  filter(gaze_condition == "no_gaze")
```


## Check the data

The goal of this section is to make sure the data match our expectations, or in other words, we are "testing" our data. Usually this involves comparing a known value to the number actually in the data set. For example, I know how I ran 20 participants, do I have 20 unique participant IDs?

[This](http://r4ds.had.co.nz/transform.html) chapter from the book **R for Data Science** is a good reference for writing code to manipulate data to do data "sanity" checks.

How many participants in the dataset?  


```{r}
uniques <- apply(table_adult, 2, function(x)length(unique(x)))
participants_adult <- uniques[1]
print(participants_adult)
```

How many trials do we have for each participant?

```{r}
table_adult %>% 
  group_by(subid, noise_condition) %>% 
  summarise(n_trials = n())

```

How many trials in each condition? 


```{r}
noise_trials_adult <- table(table_adult["noise_condition"])
num_no_noise_adult <- noise_trials_adult["no_noise"]
num_noise_adult <- noise_trials_adult["noise"]

num_no_noise_adult
num_noise_adult
```

## Clean up the data

Add variable that stores information about center-initial shifts

```{r}
#Add variable that stores information about center-initial shifts
table_adult <- table_adult %>% 
  mutate(shift_start_location = ifelse(shift_type %in% c("C_T", "C_D"), "center", "not_center"))

#Filter out extreme RTs based on +/- 3 sd from the mean
table_adult <- table_adult %>% filter(rt <= 4)

#Remove shifts that do not start at center.
table_adult.analysis <- table_adult %>% 
  filter(shift_start_location == "center",
         !(is.na(shift_accuracy)))
```
## Explore data via visualization

[This](http://r4ds.had.co.nz/data-visualisation.html) is a great book chapter on data visualization using the ggplot2 R package

### Visualize data distributions

My goal when I visualize the distribution of a variable is usually to check if there any data points that look like outliers (really different from the other values in the sample). There are more precise, quantitative ways to define outlier, but the visualization helps us spot them quickly. If some observations look really different, I then try to reason about why that might be the case: data entry error? equipment measurement error? 

What does the distribution of age in the sample look like? 

```{r}

ggplot(data = table_adult.analysis) + geom_point(mapping = aes(x= subid, y=age)) 

```

What about Reaction Times (RT)?


```{r}
table_adult.analysis %>% 
  ggplot() + geom_point(mapping = aes(x = subid, y = rt))
```


What about Accuracy? 

```{r}
table_adult.analysis %>% 
  ggplot() +  geom_bar(mapping = aes(x = subid, fill = shift_accuracy)) +
  theme(axis.text.x = element_text(angle = 90)) +
  facet_wrap(~noise_condition)
```

### Visualize Accuracy

When thinking about 

What is the overall accuracy of first shifts?

```{r}
table_adult.analysis %>% 
  ggplot() + geom_bar(mapping = aes(x = shift_accuracy))
```

What about the accuracy for each condition?

```{r}
table_adult.analysis %>% 
  ggplot()+ geom_bar(mapping = aes(x = noise_condition, fill = shift_accuracy), position = "fill")
```

### Visualize Reaction Time

What is the overall RT for participants in the experiment? 

```{r}
  ggplot(data = table_adult.analysis) + 
  geom_boxplot(mapping = aes(x = noise_condition, y = rt))
```

What about RTs for correct vs. incorrect shifts?

```{r}
table_adult.analysis %>% 
  ggplot() + geom_line(mapping = aes(x = rt, color = shift_accuracy), stat = "density") +
  facet_wrap(~noise_condition, ncol = 2) +
  theme_bw()

```

What about RTs separated by condition? 

```{r}
table_adult.analysis %>% 
  ggplot() + geom_histogram(mapping = aes(x = rt, fill = noise_condition)) +
  facet_wrap(~shift_accuracy, ncol = 2)

```

## Aggregated visualizations

```{r}
ss_adult <- table_adult.analysis %>% 
  group_by(subid, noise_condition, shift_accuracy) %>% 
  summarise(m_rt = mean(rt))
```

```{r}
 ss_adult %>% 
  ggplot() + 
  geom_boxplot(mapping = aes(x = noise_condition, y = m_rt), fill = ("#F8766D"))
```

```{r}
ms_adult <- ss_adult %>% 
  group_by(noise_condition, shift_accuracy) %>% 
  summarise(m = mean(m_rt),
            stdev = sd(m_rt))
```

Let's try visualizing RT distributions using dotplots

```{r}
acc_colors <- c("grey10", "black")
fill_vals <- c("#F8766D", "#00BFC4")

p_adult <- table_adult.analysis %>% 
  ggplot(aes(x = forcats::fct_rev(noise_condition), y = rt, 
             color = shift_accuracy, fill = shift_accuracy)) +
  ggbeeswarm::geom_quasirandom(shape = 21) + 
  scale_color_manual(values = acc_colors) +
  scale_fill_manual(values = fill_vals) +
  labs(y = "RT (sec)", x = NULL) +
  theme_bw() +
  theme(legend.position = "right") + 
  theme(axis.title.x = element_text(size = 16, 
                                    face = "bold"), 
        axis.title.y = element_text(size = 16, 
                                    face = "bold"), axis.text.x = element_text(size = 14),
        axis.text.y = element_text(size = 14)) +
  coord_flip()

p_adult
```


## Statistical models

We can talk more about this aspect of the anlaysis once you made some progress on data viz. 

