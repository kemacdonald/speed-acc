---
title: "Speed-acc-kids EWMA"
author: "Kyle MacDonald"
output: html_document
---

This script analyzes first shift accuracy and RT using an EWMA guesssing model. In the task, we vary the information value and the saliency of the center fixation and measure the effects on accuracy and RT.

There are 4 different datasets with different center fixations:

1. ASL (27 kids: 18-54m, median age = 27 months): human signing
2. Face (22 kids: 26m): human face talking
3. Trio (18 kids at 26m and 22 kids at 36m): static images of real world objects, e.g., cats
4. Bull (22 kids at 26m): different static "bullseyes"

## Setup

Load libraries and read in tidy data.

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo=F, warning=F, cache=F, message=F, sanitize = T)
source("../../helper_functions/libraries_and_functions.R")
```

Read data and create a clean condition variable.

```{r read data}
df <- read_csv("../../../data/3_final_merged_data/speed-acc-participant-level-df.csv") 

df %<>% 
  mutate(stimuli = ifelse(stimuli %in% c("V1", "V2"), "ASL", 
                          ifelse(stimuli == "Trio", "Object", 
                                 ifelse(stimuli == "Bull", "Bullseye",
                                        stimuli))),
         stimuli = factor(stimuli, levels = c("ASL", "Face", "Object", "Bullseye")))
```

Read in EWMA model estimates. This model was fit in the .Rmd file for the cogsci paper. I should move it here (TODO)

```{r}
d.ewma <- read_csv("../../../data/3_final_merged_data/speed_acc_kids_ewma_results.csv")
```

## Descriptives

How many participants in each stimuli set and language modality? `Age_code_m` is a hacky way to track the different age groups that saw the Trio stimuli.

```{r}
df %>% 
  select(Sub.Num, language_modality, age_code, stimuli) %>% 
  unique() %>% 
  group_by(language_modality, age_code, stimuli) %>% 
  dplyr::summarise(count = n()) %>% 
  knitr::kable()
```

## First shift anlayses (Accuracy, RT, EWMA)

```{r}
df %>% 
  filter(age_code == "child") %>% 
  select(Sub.Num, language_modality, age_code, stimuli, age_years) %>% 
  unique() %>%
  ggplot(aes(age_years, fill = language_modality)) +
  geom_histogram() +
  scale_fill_solarized() +
  facet_grid(.~language_modality) +
  guides(fill = F)
```

ASL group has wide range of ages; whereas the spoken language kids are tightly clustered around 2 and 3 years of age. TODO: check the ages for the English 2 year olds. Are they all really 26 months?

### First shift accuracy

First we get the proportion correct for each participant in each age group and language modality.

```{r}
ss_prop <- df %>% 
  group_by(Sub.Num, age_code, Months, language_modality, 
           stimuli, hearing_status_participant) %>% 
  filter(trial_type != "no_shift") %>% 
  summarise(mean_correct = mean(correct))

ss_prop <- df %>% 
  group_by(Sub.Num, age_code, Months, language_modality, stimuli, correct, 
           hearing_status_participant) %>%
  filter(trial_type != "no_shift") %>% 
  summarise(mean_rt = median(RT)) %>% 
  left_join(ss_prop)
```

Then we make a boxplot of first shift accuracy as a function of condition.

```{r boxplot acc}
ggplot(aes(x = stimuli, y = mean_correct, fill = language_modality), 
       data = filter(ss_prop, age_code == "child", correct == 1)) +
  geom_boxplot(outlier.colour = "red", width = 0.5) +
  geom_jitter(width = 0.2, alpha = 0.35) +
  geom_hline(yintercept = 0.5, lty = "dashed") +
  ylim(0,1) +
  xlab(NULL) +
  ylab("Mean Accuracy") +
  scale_fill_solarized() +
  guides(fill = F) +
  ggtitle("Accuracy") +
  theme(text = element_text(size = 16))
```

We see that the ASL group was the most accurate, followed by Face, and then Object and Bullseye. Inf fact, it looks like the first shift behavior of the Object and Bullseye conditions were random.

### RT analysis

Get medians and CIs for correct/inccorect shifts for each stimuli set and language modality 

```{r}
ms_rt <- ss_prop %>%
  filter(age_code == "child") %>% 
  group_by(language_modality, age_code, stimuli, correct) %>% 
  multi_boot_standard(column = "mean_rt", na.rm = T, empirical_function = "median")
```

RT boxplot

```{r rt boxplot}
ss_prop$stimuli <- factor(ss_prop$stimuli, 
                          levels = c("Bullseye", "Object", "Face", "ASL"))

ggplot(aes(x = stimuli, y = mean_rt / 1000, fill = language_modality), 
       data = filter(ss_prop, age_code == "child", correct == 1)) + 
  geom_boxplot(outlier.colour = "red") +
  geom_jitter(width = 0.4, alpha = 0.35) +
  scale_fill_solarized() +
  guides(fill = F) + 
  xlab(NULL) +
  ylab("Median RT (sec)") +
  coord_flip() +
  ggtitle("Reaction Time") +
  theme(text = element_text(size = 12))
```

Now we can make the same boxplot, but split the RTs by correct and incorrect shifts to look for evidence of speed-accuracy tradeoffs in the decision process.

Boxplot of RTs for correct/incorrect tirals

```{r}
ggplot(aes(x = stimuli, y = mean_rt / 1000, fill = as.factor(correct)), 
       data = filter(ss_prop, age_code == "child")) + 
  geom_boxplot(outlier.colour = "darkgreen") +
  geom_point(pch = 21, position = position_jitterdodge(), alpha = 0.6) +
  scale_fill_solarized() +
  labs(x = NULL, y = "Median RT (sec)", title = "Reaction Time", fill = "Correct") +
  theme(text = element_text(size = 12))
```

We see evidence of speed accuracy tradeoffs in the ASL, Face, and Bull conditions -- that is, incorrect responses tend to be faster than correct responses --  but not in the Object condition.

### Plot distributions of correct and incorrect RTs

Note the RT cutoff for the long tail. When you cut off more of the tail, the difference between median correct and inccorrect shifting increases. It's interesting to think about whether RTs in these long tails are meaningful. 

```{r median rts for each condition}
med_all <- df %>% 
  group_by(age_code, language_modality, stimuli, correct) %>% 
  summarise(med_rt = median(RT, na.rm = T)) %>%
  mutate(Response.Type = ifelse(correct == 1, "Correct", "Incorrect"),
         Response.Type = factor(Response.Type, levels = c("Incorrect", "Correct")))

df %<>% 
  mutate(Response.Type = ifelse(correct == 1, "Correct", "Incorrect"),
         Response.Type = factor(Response.Type, levels = c("Correct", "Incorrect")))
```

Now plot the distribution of RTs

```{r}
ggplot(aes(x = RT / 1000, fill = Response.Type), 
       data = filter(df, age_code == "child")) +
  geom_histogram(position = "stack", color = "black") +
  facet_grid(stimuli ~ .) +
  guides(color = F) + 
  labs(x = "RT (sec)", y = "Density", fill = "Shift Accuracy") +
  scale_fill_manual(values = c("dodgerblue", "darkorange")) +
  scale_color_manual(values = c("darkorange", "dodgerblue")) +
  theme(text = element_text(size=11),
        legend.position = "right")
```

## EWMA model of guessing behavior

## Plot EWMA model output

```{r}
ss.responding.prop <- d.ewma %>% 
  group_by(Sub.Num, condition, guess) %>% 
  summarise(count = n()) %>% 
  mutate(prop.responding = round(count / sum(count), 2))
```

Plot

```{r}
ss.responding.prop %>% 
  filter(condition %in% c("ASL", "Face"), guess == "response") %>% 
  ggplot(aes(x = fct_rev(condition), y = prop.responding)) +
  geom_boxplot(fill = "dodgerblue", width = 0.3, alpha = 0.9) +
  labs(x = "Condition",y = "Prop. Shifts Language Driven") +
  theme(text = element_text(size = 12))
```

## Write EWMA results to .csv file 
