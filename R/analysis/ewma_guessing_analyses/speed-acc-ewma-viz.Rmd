---
title: "Speed-Acc Visualize EWMA"
output: html_document
---

```{r setup, include=FALSE}
rm(list=ls())
knitr::opts_chunk$set(echo=F, warning=F, cache=F, message=F, sanitize = T, fig.height=6, fig.width=6)
````

```{r}
source("../../helper_functions/libraries_and_functions.R")
source("../../helper_functions/ewma_helper_funs.R")
ewma.path <- "../../../data/3_final_merged_data/ewma_output/"
plot.save.path <- "../../../paper/figs/"
```

## Read data

```{r read data}
files <- dir(path = ewma.path, pattern = "*.csv") 

# read in all files using purrr
d <- files %>% purrr::map_df(read_ewma, path = ewma.path)
```

## Visualize EWMA results: control charts

Make all the control charts. 

```{r}
ewma_control_charts_trio <- d %>% 
  filter(rt <= 1.5, experiment == "trio") %>% 
  split(.$experiment) %>% 
  purrr::map(.f = aggregate_ewma) %>% 
  purrr::map(.f = plot_ewma_chart)
```

```{r}
ewma_control_charts <- d %>% 
  filter(rt <= 1, experiment != "trio") %>% 
  split(.$experiment) %>% 
  purrr::map(.f = aggregate_ewma) %>% 
  purrr::map(.f = plot_ewma_chart)
```

### Experiment 1: Trio (kids)

```{r kid_ewma}
ewma_control_charts_trio$trio
```

### Experiment 2: Text (Adults)

```{r}
ewma_control_charts$text
```

### Experiment 3: Noise and Gaze (kids)

```{r, fig.width = 9, fig.height = 4}
cowplot::plot_grid(ewma_control_charts$noise, ewma_control_charts$gaze, 
                   ncol = 2)
```

### Experiment 3: Noise and Gaze (adults)

```{r}
ewma_control_charts$noise_gaze
```

Save control charts.

```{r save_control_charts, eval = F}
# text
ggsave(plot = ewma_control_charts$text, 
       filename = paste0(plot.save.path, "e2_control_chart.png"), 
       width = 3, height = 3.5)

# noise gaze adults
ggsave(plot = ewma_control_charts$noise_gaze, 
       filename = paste0(plot.save.path, "adult_ng_control_chart.png"), 
       width = 3, height = 3.5)

# trio kids
ggsave(plot = ewma_control_charts$trio, 
       filename = paste0(plot.save.path, "e1_control_chart.png"), 
       width = 3, height = 3.5)
```

## Visualize EWMA results: Proportion guessing boxplots 

```{r}
make_ewma_boxplot <- function(d) {
  # aggregate prop guessing for each participant
  ss <- d %>% 
    group_by(subid, condition, guess) %>% 
    summarise(count = n()) %>% 
    mutate(prop.responding = round(count / sum(count), 2))
  
  # make plot
  ss %>% 
    filter(guess == "response") %>% 
    ggplot(aes(x = fct_reorder(condition, prop.responding), y = prop.responding)) +
    geom_boxplot(fill = "dodgerblue", width = 0.2, alpha = 0.9, outlier.color = "white",
                 notch = F) +
    lims(y = c(0,1)) +
    labs(x = "Condition", y = "Prop. Language Driven") 
  
}
```

Make all the boxplots for each experiment. 

```{r}
ewma_boxplots <- d %>% 
  filter(rt <= 1) %>% 
  split(.$experiment) %>% 
  purrr::map(.f = make_ewma_boxplot)
```

Put all the boxplots together. 

### Experiment 1: Trio (kids)

```{r, fig.height = 4}
ewma_boxplots$trio 
```

### Experiment 2: Text (Adults)

```{r, fig.height = 4}
ewma_boxplots$text
```

### Experiment 3: Noise and Gaze (kids)

```{r, fig.height = 4}
cowplot::plot_grid(ewma_boxplots$noise, ewma_boxplots$gaze, ncol = 2)
```

### Experiment 3: Noise and Gaze (adults)

```{r, fig.height = 4}
ewma_boxplots$noise_gaze
```