---
title: "Speed-Acc Robust Graphical Methods (Rogme)"
output: html_notebook
editor_options: 
  chunk_output_type: inline
---


## Setup

Load libraries and read in tidy data.

```{r setup, include=FALSE}
rm(list=ls())
knitr::opts_chunk$set(echo=F, warning=F, cache=F, message=F, sanitize = T)
source("../../helper_functions/libraries_and_functions.R")
library(tidyverse); library(lme4)
library(rogme) # key package for making visualizations
```

```{r read data}
read.path <- "../../../data/3_final_merged_data/"
d.fs <- read_csv(paste0(read.path, "speed_acc_adult_fstshift_tidy.csv.gz"))
d.asl <- read_csv(paste0(read.path, "speed-acc-ss-df.csv"))
```

Clean the spoken English and sign language datasets, so we can merge them.

```{r clean datasets to merge}
d.asl %<>% 
  filter(language_modality == "ASL" & age_code == "adult") %>% 
  mutate(subid = as.character(Sub.Num),
         tr.num = Tr.Num, 
         rt = RT_sec,
         shift_type = trial_type,
         condition = language_modality, 
         hearing_status = hearing_status_participant,
         response_onset_type = "noun") %>% 
  select(subid, tr.num, rt, shift_type, hearing_status, condition, response_onset_type)

d.fs %<>%
  mutate(hearing_status = "hearing") %>% 
  select(subid, tr.num, rt, shift_type, hearing_status, condition, response_onset_type)
```

Merge the datasets.

```{r merge asl and english data}
d.fs %<>% bind_rows(., d.asl) %>% 
  mutate(shift_accuracy = ifelse(shift_type == "C_T", 
                                 "correct", "incorrect"))
```


## Visualize condition effects on distributions of RTs


Let's try to make the beeswarm plots for all the conditions. 

```{r}
acc_colors <- c("grey10", "black")
fill_vals <- c("grey90", "darkviolet")

p <- d.fs %>% 
  filter(response_onset_type == "noun",
         is.na(rt) == F) %>% 
  ggplot(aes(x = forcats::fct_rev(condition), y = rt, color = shift_accuracy, fill = shift_accuracy)) +
  ggbeeswarm::geom_quasirandom(shape = 21) + 
  scale_color_manual(values = acc_colors) +
  scale_fill_manual(values = fill_vals) +
  labs(y = "RT (sec)", x = NULL) +
  theme_bw() +
  theme(legend.position = "right") + theme(axis.title.x = element_text(size = 16, 
                                                                       face = "bold"), axis.title.y = element_text(size = 16, 
                                                                                                                   face = "bold"), axis.text.x = element_text(size = 14), 
                                           axis.text.y = element_text(size = 14)) +
  coord_flip()

p
```

Let's add the deciles for each condition. First we need to make our own function to get the deciles for each condition. 


```{r add deciles to plot}
plot_dec_bars(p, col = "darkorange", dec_size = 0.8, alpha = 0.5)
```

Next let's zoom in on some comparisons of interest. ASL compared to Face.

```{r}
# make tibble
library(rogme)

df <- d.fs %>% 
  filter(condition %in% c('ASL', 'face'),
         response_onset_type == "noun",
         is.na(rt) == F) %>% 
  select(condition, rt) %>%
  mutate(condition = as.factor(condition),
         rt = rt) %>% 
  as_tibble()
```

Make plots. 

```{r}
ps <- plot_scat2(df,
                 xlabel = "",
                 ylabel = "RTs (sec)",
                 alpha = 1,
                 shape = 21,
                 colour = "grey10",
                 fill = "grey90") # scatterplots
ps <- ps + coord_flip()

#> compute shift function
sf <- shifthd(data = df, formula = rt ~ condition, nboot = 200)

#> plot shift function
psf <- plot_sf(sf, plot_theme = 2)

#> change axis labels
psf <- psf +
  labs(x = "Face condition quantiles RTs",
       y = "Face condition - ASL condition \nquantile differences (RTs)")

#> add labels for deciles 1 & 9
psf <- add_sf_lab(psf, sf, y_lab_nudge = .1)

p <- plot_scat2(df,
                xlabel = "",
                ylabel = "RTs (sec)",
                alpha = .3,
                shape = 21,
                colour = "grey10",
                fill = "grey90") # scatterplots
p <- plot_dec_links(p, sf,
                    dec_size = 1,
                    md_size = 1.5,
                    add_rect = TRUE,
                    rect_alpha = 0.1,
                    rect_col = "grey50",
                    add_lab = TRUE) # superimposed deciles + rectangle
p <- p + coord_flip() # flip axes
```

```{r}
library(cowplot)
#> Warning: `legend.margin` must be specified using `margin()`. For the old
#> behavior use legend.spacing
cowplot::plot_grid(ps, p, psf, labels=c("A", "B", "C"), ncol = 1, nrow = 3,
                   rel_heights = c(1, 1, 1), label_size = 20, hjust = -0.5, scale=.95)
```

